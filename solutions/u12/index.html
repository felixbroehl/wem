<h1>Sicherheit – Übung 12</h1>
<div class="task">
    <h2>12.1. Sicherer ArrayWrapper</h2>
    <p>In der Vorlesung wurde ein ArrayWrapper Exploit gezeigt.</p>
    <p>Analysieren Sie die Ursache dieses Exploits.</p>
    <answer-block>Gedacht ist der Parameter der Set-Funktion für number-Werte. JavaScript hat an dieser Stelle jedoch keine Typsicherheit und somit kann jeder mögliche Datentyp übergeben werden. mit .set('push',...) kann somit auch eine Funktion des Array-Prototyps überschrieben werden. Da die Funktion im Wrapper push aufgerufen wird und vorher überschrieben wurde, kann somit beim Aufruf von append() der innere Array-Kontext "geklaut" werden.</answer-block>
    <p>Entwickeln Sie ein Sicherheitskonzept und eine ArrayWrapper-Lösung, die gegen diesen Exploit gewappnet ist.</p>
    <answer-block>Sicherheitskonzept: Beim Funktionsaufruf als Erstes prüfen, ob der "pos"-Parameter für get und set ein Integer ist, ansonsten soll ein Fehler geworfen werden.</answer-block>
    <run-code jsSrc="a1.js"></run-code>
    <h2>12.2. WebGoat Injection</h2>
    <p>Lösen Sie die Aufgaben in (A1) Injection, SQL Injection (Intro).</p>
    <p><b>Aufgabe 2:</b></p>
    <p>Für Aufgabe 2 sollte das Department des eigenen Nutzers herausgefunden werden:</p>
    <img src="webgoat/sql/l1.png" width="400" />
    <p><b>Aufgabe 3:</b></p>
    <p>Bei Aufgabe 3 sollte das <inline-code-preview>department</inline-code-preview>-Feld für den Mitarbeiter Tobi Barnett geändert werden.</p>
    <img src="webgoat/sql/l2.png" width="500" />
    <p><b>Aufgabe 4:</b></p>
    <p>Ziel von Aufgabe 4 war es eine neue Spalte <inline-code-preview>phone</inline-code-preview> hinzuzufügen.</p>
    <img src="webgoat/sql/l3.png" width="480" />
    <p><b>Aufgabe 5:</b></p>
    <p>Für Aufgabe 5 sollten dem Nutzer <inline-code-preview>unauthorized_user</inline-code-preview> Rechte auf die Tabelle <inline-code-preview>grant_rights</inline-code-preview> verschafft werden.</p>
    <img src="webgoat/sql/l4.png" width="490" />
    <p><b>Aufgabe 9:</b></p>
    <p>Bei Aufgabe 9 sollte der gesamte Inhalt der <inline-code-preview>user_data</inline-code-preview>-Tabelle zurückgegeben würden über eine SQL-Injection.</p>
    <img src="webgoat/sql/l8.png" />
    <p><b>Aufgabe 10:</b></p>
    <p>Ziel von Aufgabe 10 war es den gesamten Inhalt der <inline-code-preview>user_data</inline-code-preview>-Tabelle zurückgegeben würden über eine SQL-Injection aus Eingabefeldern heraus.</p>
    <img src="webgoat/sql/l9.png" />
    <p><b>Aufgabe 11:</b></p>
    <p>Für Aufgabe 11 sollte der gesamte Inhalt der <inline-code-preview>employees</inline-code-preview>-Tabelle zurückgegeben würden über eine SQL-Injection aus Eingabefeldern heraus.</p>
    <img src="webgoat/sql/l10.png" />
    <p><b>Aufgabe 12:</b></p>
    <p>Bei Aufgabe 12 sollte das eigene Gehalt höher als das von allen anderen Mitarbeitern gesetzt werden mittels einer SQL-Injection.</p>
    <img src="webgoat/sql/l11.png" />
    <p><b>Aufgabe 13:</b></p>
    <p>Da die vorherigen Aktionen geloggt wurden, sollten diese mittels einer SQL-Injection aus der <inline-code-preview>access_log</inline-code-preview>-Tabelle gelöscht werden.</p>
    <img src="webgoat/sql/l12.png" width="700" />
    <h2>12.3. WebGoat XSS</h2>
    <p>Lösen Sie die Aufgaben in (A7) Cross-Site Scripting (XSS), Cross Site Scripting.</p>
    <p><b>Aufgabe 2:</b></p>
    <p>Für Aufgabe 2 sollte überprüft werden, ob WebGoat die gleichen Cookies in einem weiteren Tab hat.</p>
    <img src="webgoat/xss/l1.png" width="500" />
    <p><b>Aufgabe 7:</b></p>
    <p>Ziel von Aufgabe 7 war es eine simple XSS-Attacke durchzuführen in WebGoat als <inline-code-preview>alert()</inline-code-preview>. Dabei war das Kreditkartennummer-Feld eine Schwachstelle.</p>
    <img src="webgoat/xss/l6.png" />
    <p><b>Aufgabe 10:</b></p>
    <p>Bei Aufgabe 10 sollte eine nicht in den Produktionscode gehörende test-Route gefunden werden. Diese liess sich über den Quelltext auffinden.</p>
    <img src="webgoat/xss/l9.png" width="550" />
    <p><b>Aufgabe 11:</b></p>
    <p>Ziel von Aufgabe 11 war es die vorherige Test-Route zu nutzen, um eine XSS-Attacke durchzuführen. Für das Encoding als Parameter wurde die JavaScript-Funktion <inline-code-preview>encodeUriComponent()</inline-code-preview> genutzt. Danach konnte die URL <inline-code-preview>/WebGoat/start.mvc#test/%3Cscript%3Ewebgoat.customjs.phoneHome()%3C%2Fscript%3E</inline-code-preview> aufgerufen werden, um den Exploit auszuführen.</p>
    <img src="webgoat/xss/l10_1.png" />
    <p>Der Konsole konnte anschließend der Lösungs-Schlüssel entnommen werden.</p>
    <img src="webgoat/xss/l10_2.png" width="300" />
    <p><b>Aufgabe 12:</b></p>
    <p>Aufgabe 12 zu XSS dar. Nachfolgend sind die Antworten aufgeführt:</p>
    <img src="webgoat/xss/l11_1.png" />
    <img src="webgoat/xss/l11_2.png" />
    <h2>12.3. WebGoat Cross-Site Request Forgeries</h2>
    <p>Lösen Sie die Aufgaben zu (A8:2013) Request Forgeries, Cross-Site Request Forgeries.</p>
    <p><b>Aufgabe 3:</b></p>
    <p>Ziel von Aufgabe 3 war es eine simple CSRF-Attacke durchzuführen in WebGoat. Dafür konnte folgende HTML-Datei genutzt werden:</p>
    <code-preview src="webgoat/csrf/l2.html"></code-preview>
    <img src="webgoat/csrf/l2.png" width="500" />
    <p><b>Aufgabe 4:</b></p>
    <p>Ziel von Aufgabe 4 war es ein Bewertung für ein Bild abzusetzen als CSRF-Attacke in WebGoat. Dafür konnte folgende HTML-Datei genutzt werden:</p>
    <code-preview src="webgoat/csrf/l3.html"></code-preview>
    <p>Dies war erfolgreich:</p>
    <img src="webgoat/csrf/l3.png" width="300" />
    <p><b>Aufgabe 7:</b></p>
    <p>Ziel von Aufgabe 7 war es ein application/json-Anfrage zu senden. Hierfür wurde jedoch die Content-Type-Prüfung im Backend vergessen. Eine CSRF-Attacke konnte als text/plain ausgeführt werden mit folgender HTML-Datei:</p>
    <code-preview src="webgoat/csrf/l6.html"></code-preview>
    <img src="webgoat/csrf/l6.png" width="500" />
</div>